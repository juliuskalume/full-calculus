<!DOCTYPE html>
<html class="light" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <link rel="manifest" href="manifest.webmanifest" />
    <meta name="theme-color" content="#0d59f2" />
    <link rel="apple-touch-icon" href="icons/icon-192.png" />
    <link rel="icon" type="image/png" href="icons/icon-192.png" />
    <title>Full Calculus — Settings</title>

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#0d59f2",
              "primary-hover": "#0b4dc9",
              "background-light": "#f5f6f8",
              "background-dark": "#101622",
              "surface-light": "#ffffff",
              "surface-dark": "#1a2332",
              "text-main": "#0d121c",
            },
            fontFamily: {
              display: ["Lexend", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "1rem",
              lg: "1.5rem",
              xl: "2rem",
              full: "9999px",
            },
            boxShadow: {
              soft: "0 4px 20px -2px rgba(0,0,0,0.06)",
              "press-blue": "0 4px 0 0 #0b4dc9",
            },
          },
        },
      };
    </script>

    <style>
      body {
        font-family: "Lexend", sans-serif;
        min-height: max(884px, 100dvh);
      }
      .material-symbols-outlined {
        font-variation-settings: "FILL" 1, "wght" 550, "GRAD" 0, "opsz" 24;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .press:active {
        transform: translateY(4px);
        box-shadow: none !important;
      }

      /* iOS-like switch */
      .ios-switch {
        position: relative;
        display: inline-block;
        width: 46px;
        height: 26px;
      }
      .ios-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        inset: 0;
        background-color: #cbd5e1;
        transition: 0.25s;
        border-radius: 999px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: 0.25s;
        border-radius: 999px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
      }
      input:checked + .slider {
        background-color: #0d59f2;
      }
      input:checked + .slider:before {
        transform: translateX(20px);
      }
    </style>
    <script src="theme.js"></script>
  </head>

  <body
    data-step="settings"
    class="bg-background-light dark:bg-background-dark text-text-main dark:text-white transition-colors duration-200 antialiased"
  >
    <!-- Mobile shell (Full Calculus structure) -->
    <div
      class="w-full max-w-md mx-auto h-[100dvh] sm:min-h-screen bg-background-light dark:bg-background-dark shadow-2xl flex flex-col overflow-hidden"
    >
      <!-- Sticky Header -->
      <header
        class="sticky top-0 z-30 bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-md border-b border-slate-200 dark:border-slate-800"
      >
        <div class="flex items-center p-4 justify-between">
          <div class="flex items-center gap-2">
            <button
  type="button"
  onclick="(history.length > 1) ? history.back() : location.href='path.html'"
  class="press flex items-center justify-center w-10 h-10 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
  aria-label="Back"
>
  <span class="material-symbols-outlined text-primary">arrow_back</span>
</button>

            <h2 class="text-lg font-extrabold leading-tight tracking-tight">Settings</h2>
          </div>

          <button
            id="saveBtn"
            type="button"
            class="press text-primary text-sm font-extrabold px-4 py-2 rounded-xl bg-primary/10 hover:bg-primary/15 transition-colors"
          >
            Save
          </button>
        </div>
      </header>

      <!-- Scrollable content -->
      <main class="flex-1 overflow-y-auto no-scrollbar px-4 pb-10">
        <!-- Profile Header -->
        <div class="flex items-center gap-4 py-6">
          <div class="relative">
            <div
              class="size-16 rounded-full bg-primary/10 flex items-center justify-center border-2 border-primary overflow-hidden bg-cover bg-center"
              id="avatar"
              style="background-image:url('https://lh3.googleusercontent.com/aida-public/AB6AXuAjJgU1KehmpiXls43bsZMi4GiRPb2uMd15jYvGZrKwrMfMMw8HxoSl6l4Nn8NknLMaqKInBexcAtf-ewoucv8GBFeUBIrG6WuC9mOMpZQE1YsbV1zLmbI_z0xboRI3hDCePdqhhHUv4Gm_Y3CSZPq_hlAEIwdUfdF0o_QgVxIcengtQOS4ZJ8X0c6SXO5x6UXMyEtKvKsYDuz_WJZP-d0oPoWpeMA8pzMuTSu4MSOlgoQdqxiX9Bqc4K2hC5fW8HSphxcvdsSeqlo');"
              aria-label="User avatar"
            ></div>
            <div
              class="absolute -bottom-1 -right-1 bg-yellow-400 size-6 rounded-full flex items-center justify-center border-2 border-white dark:border-background-dark"
              aria-hidden="true"
            >
              <span class="material-symbols-outlined text-[14px] text-white">bolt</span>
            </div>
          </div>

          <div class="min-w-0">
            <h3 id="nameText" class="text-xl font-extrabold truncate">Student</h3>
            <p class="text-primary text-sm font-semibold">
              <span id="courseText">Calculus I</span> • <span id="leagueText">Diamond League</span>
            </p>
          </div>
        </div>

        <!-- Account -->
        <section class="mb-6">
          <h3 class="text-sm font-extrabold uppercase tracking-wider text-slate-500 dark:text-slate-400 px-1 pb-2">
            Account
          </h3>

          <div class="bg-white dark:bg-surface-dark rounded-2xl overflow-hidden shadow-sm border border-slate-100 dark:border-slate-800">
            <div class="flex items-center gap-4 px-4 min-h-[72px] py-2 justify-between border-b border-slate-100/60 dark:border-slate-800">
              <div class="flex flex-col justify-center min-w-0">
                <p class="text-base font-semibold leading-normal">Email</p>
                <p id="emailText" class="text-slate-500 dark:text-slate-400 text-sm font-medium leading-normal truncate">
                  not set
                </p>
              </div>
              <button
                id="editEmailBtn"
                class="press flex min-w-[70px] items-center justify-center rounded-xl h-9 px-4 bg-primary/10 text-primary text-sm font-extrabold hover:bg-primary/20 transition-colors"
                type="button"
              >
                Edit
              </button>
            </div>

            <div class="flex items-center gap-4 px-4 min-h-[56px] justify-between">
              <p class="text-base font-semibold leading-normal flex-1">Password</p>
              <button
                id="changePwBtn"
                class="press flex min-w-[90px] items-center justify-center rounded-xl h-9 px-4 bg-primary/10 text-primary text-sm font-extrabold hover:bg-primary/20 transition-colors"
                type="button"
              >
                Change
              </button>
            </div>
          </div>
        </section>

        <!-- Daily Goal -->
        <section class="mb-6">
          <h3 class="text-sm font-extrabold uppercase tracking-wider text-slate-500 dark:text-slate-400 px-1 pb-2">
            Daily Goal
          </h3>

          <div class="bg-white dark:bg-surface-dark rounded-2xl p-4 shadow-sm border border-slate-100 dark:border-slate-800">
            <div class="flex items-center justify-between mb-4">
              <div>
                <p class="text-base font-extrabold" id="goalName">Regular</p>
                <p class="text-sm text-slate-500 dark:text-slate-400 font-medium" id="goalDesc">15 minutes / day</p>
              </div>
              <span class="material-symbols-outlined text-primary">schedule</span>
            </div>

            <div class="grid grid-cols-4 gap-2" id="goalGrid">
              <button data-goal="casual" class="press flex flex-col items-center justify-center p-2 rounded-xl border border-slate-200 dark:border-slate-800 text-xs font-extrabold hover:bg-primary/5" type="button">
                Casual
              </button>
              <button data-goal="regular" class="press flex flex-col items-center justify-center p-2 rounded-xl border-2 border-primary bg-primary/5 text-xs font-extrabold text-primary" type="button">
                Regular
              </button>
              <button data-goal="serious" class="press flex flex-col items-center justify-center p-2 rounded-xl border border-slate-200 dark:border-slate-800 text-xs font-extrabold hover:bg-primary/5" type="button">
                Serious
              </button>
              <button data-goal="intense" class="press flex flex-col items-center justify-center p-2 rounded-xl border border-slate-200 dark:border-slate-800 text-xs font-extrabold hover:bg-primary/5" type="button">
                Intense
              </button>
            </div>
          </div>
        </section>

        <!-- Preferences -->
        <section class="mb-6">
          <h3 class="text-sm font-extrabold uppercase tracking-wider text-slate-500 dark:text-slate-400 px-1 pb-2">
            Preferences (might need Restart)
          </h3>

          <div class="bg-white dark:bg-surface-dark rounded-2xl overflow-hidden shadow-sm border border-slate-100 dark:border-slate-800">
            <div class="flex items-center gap-4 px-4 min-h-[56px] justify-between border-b border-slate-100/60 dark:border-slate-800">
              <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-slate-500">dark_mode</span>
                <p class="text-base font-semibold">Dark Mode</p>
              </div>
              <label class="ios-switch" aria-label="Dark Mode toggle">
                <input id="darkModeSwitch" type="checkbox" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="flex items-center gap-4 px-4 min-h-[56px] justify-between border-b border-slate-100/60 dark:border-slate-800">
              <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-slate-500">volume_up</span>
                <p class="text-base font-semibold">Sound Effects</p>
              </div>
              <label class="ios-switch" aria-label="Sound Effects toggle">
                <input id="soundSwitch" type="checkbox" checked />
                <span class="slider"></span>
              </label>
            </div>

            <div class="flex items-center gap-4 px-4 min-h-[56px] justify-between">
              <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-slate-500">auto_awesome</span>
                <p class="text-base font-semibold">Motivations</p>
              </div>
              <label class="ios-switch" aria-label="Motivations toggle">
                <input id="motivationSwitch" type="checkbox" checked />
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </section>

        <!-- Other / Danger -->
        <section class="mb-10 space-y-3">
          <button
            id="privacyBtn"
            class="press w-full flex items-center justify-between px-4 py-3 bg-white dark:bg-surface-dark rounded-2xl border border-slate-100 dark:border-slate-800 text-slate-700 dark:text-slate-200 font-semibold"
            type="button"
          >
            Privacy Policy
            <span class="material-symbols-outlined text-slate-400">chevron_right</span>
          </button>

          <button
            id="logoutBtn"
            class="press w-full flex items-center justify-center px-4 py-3 text-red-500 font-extrabold border border-red-100 dark:border-red-900/30 rounded-2xl bg-red-50 dark:bg-red-900/10 hover:bg-red-100 dark:hover:bg-red-900/20 transition-colors"
            type="button"
          >
            Log Out
          </button>
        </section>
      </main>
    </div>

    <!-- Shared state -->
    <script src="state.js"></script>
    <script src="progress.js"></script>
    <script src="firebase-config.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="auth.js"></script>
    <script src="./app.js"></script>

    <script>
      // ---- helpers ----
      function loadFcState() {
        try {
          return JSON.parse(localStorage.getItem("fc_state") || "{}");
        } catch {
          return {};
        }
      }
      function savePrefs(p) {
        localStorage.setItem("fc_prefs", JSON.stringify(p));
      }
      function loadPrefs() {
        try {
          return JSON.parse(localStorage.getItem("fc_prefs") || "{}");
        } catch {
          return {};
        }
      }
      function clearLocalData() {
        try {
          const keys = [];
          for (let i = 0; i < localStorage.length; i += 1) {
            const key = localStorage.key(i);
            if (key && key.startsWith("fc_")) keys.push(key);
          }
          keys.forEach((key) => localStorage.removeItem(key));
        } catch {
          try {
            localStorage.clear();
          } catch {
            // ignore
          }
        }

        try {
          sessionStorage.clear();
        } catch {
          // ignore
        }
      }

      // Hydrate header info from onboarding state
      (function hydrateProfileHeader() {
        const s = loadFcState();
        const meta = window.FC?.get ? FC.get() : { xp: 0, streak: 0, lives: 0 };

        const DEFAULT_AVATAR =
          "https://github.com/juliuskalume/full-calculus/blob/main/icons/icon-192.png?raw=true";

        const name = (s.name && String(s.name).trim()) || "Student";
        const avatarUrl = s.avatarUrl || DEFAULT_AVATAR;

        document.getElementById("nameText").textContent = name;
        document.getElementById("avatar").style.backgroundImage = `url('${avatarUrl}')`;

        // optional: make league/course feel dynamic later; placeholders for now
        document.getElementById("courseText").textContent = s.course || "Calculus I";
        document.getElementById("leagueText").textContent = s.league || "Diamond League";

        // email (if you ever store it; currently account.html doesn't persist email)
        document.getElementById("emailText").textContent = s.email ? String(s.email) : "not set";
      })();

      // Dark mode preference (keeps it consistent across screens)
      (function initPrefs() {
        const prefs = loadPrefs();

        const darkSwitch = document.getElementById("darkModeSwitch");
        const soundSwitch = document.getElementById("soundSwitch");
        const motivationSwitch = document.getElementById("motivationSwitch");

        // hydrate switches
        const isDark = document.documentElement.classList.contains("dark");
        darkSwitch.checked = prefs.darkMode ?? isDark;
        soundSwitch.checked = prefs.sound ?? true;
        motivationSwitch.checked = prefs.motivation ?? true;

        // apply dark mode immediately
        if (darkSwitch.checked) {
          document.documentElement.classList.add("dark");
          document.documentElement.classList.remove("light");
        } else {
          document.documentElement.classList.remove("dark");
          document.documentElement.classList.add("light");
        }

        function persist() {
          savePrefs({
            darkMode: darkSwitch.checked,
            sound: soundSwitch.checked,
            motivation: motivationSwitch.checked,
            dailyGoal: loadPrefs().dailyGoal || "regular",
          });
        }

        darkSwitch.addEventListener("change", () => {
          if (darkSwitch.checked) {
            document.documentElement.classList.add("dark");
            document.documentElement.classList.remove("light");
          } else {
            document.documentElement.classList.remove("dark");
            document.documentElement.classList.add("light");
          }
          persist();
        });
        soundSwitch.addEventListener("change", persist);
        motivationSwitch.addEventListener("change", persist);
      })();

      // Daily goal selector UI
      (function initDailyGoal() {
        const goalMap = {
          casual: { name: "Casual", desc: "10 minutes / day" },
          regular: { name: "Regular", desc: "15 minutes / day" },
          serious: { name: "Serious", desc: "20 minutes / day" },
          intense: { name: "Intense", desc: "30 minutes / day" },
        };

        const prefs = loadPrefs();
        let goal = prefs.dailyGoal || "regular";

        const goalName = document.getElementById("goalName");
        const goalDesc = document.getElementById("goalDesc");
        const grid = document.getElementById("goalGrid");

        function render() {
          goalName.textContent = goalMap[goal].name;
          goalDesc.textContent = goalMap[goal].desc;

          [...grid.querySelectorAll("button[data-goal]")].forEach((btn) => {
            const active = btn.dataset.goal === goal;
            btn.classList.toggle("border-2", active);
            btn.classList.toggle("border-primary", active);
            btn.classList.toggle("bg-primary/5", active);
            btn.classList.toggle("text-primary", active);

            btn.classList.toggle("border", !active);
            btn.classList.toggle("border-slate-200", !active);
            btn.classList.toggle("dark:border-slate-800", !active);
          });

          const p = loadPrefs();
          savePrefs({ ...p, dailyGoal: goal });
        }

        grid.addEventListener("click", (e) => {
          const btn = e.target.closest("button[data-goal]");
          if (!btn) return;
          goal = btn.dataset.goal;
          render();
        });

        render();
      })();

      // Save button (just confirmation for now)
      document.getElementById("saveBtn")?.addEventListener("click", () => {
        alert("Saved!");
      });

      // Account actions (placeholder)
      document.getElementById("editEmailBtn")?.addEventListener("click", () => {
        alert("Email editing (coming soon).");
      });
      document.getElementById("changePwBtn")?.addEventListener("click", () => {
        alert("Password change (coming soon).");
      });

      // Privacy + Logout
      document.getElementById("privacyBtn")?.addEventListener("click", () => {
        alert("Privacy Policy (coming soon).");
      });

      document.getElementById("logoutBtn")?.addEventListener("click", async () => {
        if (window.FCAuth?.enabled) {
          try {
            await FCAuth.signOut();
          } catch {
            // ignore
          }
        }
        clearLocalData();
        window.location.href = "login.html";
      });
    </script>
  </body>
</html>




